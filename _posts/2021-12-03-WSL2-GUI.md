---
layout: post
title: "WSL2 GUI install"
date: 2021-12-03
excerpt: "wsl2 install GNOME desktop."
tags: [Linux, WSL2, Windows 10]
comments: false
---

##### WSL2 安装

```powershell
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
```

重新启动计算机

##### 下载安装

[wsl_update_x64.msi](https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi)

```powershell
wsl --set-default-version 2
```

##### WSL2 配置

```bash
sudo sed -i 's/archive.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list
sudo sed -i 's/security.ubuntu.com/mirrors.aliyun.com/g' /etc/apt/sources.list
sudo apt update

sudo apt-get install git -y
git config --global user.name "Your Name"
git config --global user.email "youremail@domain.com"

# MySQL 推荐使用 docker 安装
# 使用阿里云镜像加速器
sudo vim /etc/docker/daemon.json
{
  "registry-mirrors": ["https://tc5zy5oj.mirror.aliyuncs.com"]
}
sudo systemctl daemon-reload
sudo systemctl restart docker
sudo docker run -d --restart always -p 3306:3306 -e MYSQL_ROOT_PASSWORD=masterA@#1 mysql:5.7
sudo docker exec -it eba274f617d6 /bin/bash
mysql -uroot -p
alter user 'root'@'%' identified with mysql_native_password by 'masterA@#1';
grant all privileges on *.* to 'root'@'%';
quit;

sudo docker run -d --restart always -p 6379:6379 redis:5

sudo apt install net-tools -y
sudo apt remove openjdk* -y
sudo apt install openjdk-8-jdk -y
sudo apt install maven -y
sudo vim /etc/maven/settings.xml
sudo apt install libreoffice -y
sudo apt install fonts-wqy-microhei ttf-wqy-zenhei -y
fc-list :lang=zh-cn
sudo locale-gen zh_CN.UTF-8
```

```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
# ExecStart=/usr/bin/dockerd -H fd:// -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock --containerd=/run/containerd/containerd.sock
sudo vim /lib/systemd/system/docker.service
# DOCKER_OPTS="-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock"
sudo vim /etc/default/docker
sudo service docker start
```

##### Windows Terminal 记住密码

```bash
sudo apt install sshpass -y
```

```powershell
wsl sshpass -p passwd ssh -oStrictHostKeyChecking=no -p 22 user@host_ip
```

##### 安装 Ubuntu GNOME desktop
```bash
# 由于Ubuntu GNOME desktop基于systemd
git clone https://hub.fastgit.org/DamionGans/ubuntu-wsl2-systemd-script.git
cd ubuntu-wsl2-systemd-script/
bash ubuntu-wsl2-systemd-script.sh
# 重启 WSL2
net stop LxssManager
net start LxssManager
# 安装 GNOME 桌面
sudo apt install ubuntu-desktop -y
# 安装 xrdp
sudo apt install xrdp -y
# 修改rdp默认端口3389，如改为43389
sudo vim /etc/xrdp/xrdp.ini
sudo systemctl start xrdp
# 打开防火墙端口
sudo ufw allow 43389
```

##### root远程登录
```shell
# 修改root密码
sudo passwd root
# 测试root登录
su root
# Port 22
# ListenAddress 0.0.0.0
# PermitRootLogin yes
# PasswordAuthentication yes
sudo vim /etc/ssh/sshd_config
sudo apt remove openssh-server -y
sudo apt install openssh-server -y
sudo service ssh --full-restart
sudo systemctl enable ssh
```
