---
layout: post
title: "WSL2 install"
date: 2021-12-03
excerpt: "wsl2 & docker install."
tags: [Linux, WSL2, Windows 10, wslg]
comments: false
---

##### WSL2 安装

```powershell
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
Restart-Computer
```

##### 更新设置版本

```powershell
# 更新前检查 Windows 10 LTSC 2021 是否安装 KB5020030
wsl --update
wsl --set-default-version 2
```

##### WSL2 配置并启用 systemd

```shell
echo -e "[boot]\nsystemd=true" | sudo tee -a /etc/wsl.conf
# 检查 systemd 是否启用，输出 init 则说明 systemd 未启用，需要检查是否安装 KB5020030 更新
ps --no-headers -o comm 1
# https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/
sudo sed -i 's/archive.ubuntu.com/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list
sudo sed -i 's/security.ubuntu.com/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list
sudo apt update
sudo apt install -fy net-tools
sudo apt install -fy fonts-noto-cjk fonts-noto-cjk-extra
sudo apt install -fy libreoffice
fc-list :lang=zh-cn
# sudo dpkg-reconfigure locales
sudo locale-gen zh_CN.UTF-8
sudo apt install -fy ffmpeg vlc firefox
# sudo apt install -fy obs-studio
sudo apt install -fy openjdk-8-jdk maven git nodejs npm
# sudo apt install -fy tomcat9
sudo apt install -fy fcitx-sunpinyin
# vim .profile
export GTK_IM_MODULE=fcitx
export QT_IM_MODULE=fcitx
export XMODIFIERS=@im=fcitx
export DefaultIMModule=fcitx
fcitx-autostart &>/dev/null
# source .profile
sudo apt install -fy ./code_1.74.0-1670260027_amd64.deb
# sudo apt install -fy ./wps-office_11.1.0.11664.XA_amd64.deb
sudo apt install -fy ./drawio-amd64-20.6.1.deb
sudo apt install -fy ./lantern-installer-64-bit.deb
```

##### 安装 docker

```shell
# curl -fsSL https://get.docker.com -o get-docker.sh && sudo sh get-docker.sh
sudo apt install -fy docker.io
# DOCKER_OPTS="-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock"
# sudo vim /etc/default/docker
sudo systemctl enable docker
sudo gpasswd -a $USER docker
newgrp docker
sudo systemctl restart docker
docker run --name mysql -d --restart always -p 3306:3306 -e MYSQL_ROOT_PASSWORD=masterA@#1 -e TZ='Asia/Shanghai' mysql:5.7
docker run --name redis -d --restart always -p 6379:6379 redis:5.0
```

##### root 远程登录

```shell
# 修改root密码
sudo passwd root
# 测试root登录
su root
# Port 22
# ListenAddress 0.0.0.0
# PasswordAuthentication yes
sudo vim /etc/ssh/sshd_config
sudo sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config
sudo apt autoremove openssh-server
sudo apt install -fy openssh-server
sudo service ssh --full-restart
sudo ufw allow ssh
```

##### Recommended Apps

- 7-Zip
- bilibili(UWP)
- Docker(WSL)
- Everything
- Fiddler Classic
- Git(/WSL)
- 火绒
- JDK8(/WSL)
- IDEA(/WSL)
- Lantern(/WSL)
- Edge
- NeatDownloadManager
- Postman(/WSL)
- 舔图猫(UWP)
- Ubuntu20.04(UWP)
- VSCode(/WSL)
- WPS(UWP~~/WSL~~)
- ~~网易云音乐(UWP)~~
- VLC(/WSL)
- OBS(~~/WSL~~)
- XMind8
- draw.io(UWP/WSL)
- nodejs(/WSL)

##### 参考

https://monkeywie.cn/2021/09/26/wsl2-gui-idea-config/
